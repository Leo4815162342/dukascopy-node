name: Download Dukascopy Tick Data

on:
  workflow_dispatch:   # manual trigger

jobs:
  download:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 20
        
      - name: Install upload deps
        run: cd tools/upload && npm install

      - name: Install dukascopy-node
        run: npm install dukascopy-node --global

      - name: Run dukascopy-node
        run: |
          npx dukascopy-node \
            -i usdhkd \
            -from 2021-01-01 \
            -to 2021-02-01 \
            -t tick \
            -f csv \
            -fn oneMonthUSDHKD

      - name: Upload to Google Drive
        env:
          GOOGLE_SERVICE_ACCOUNT_KEY: ${{ secrets.GOOGLE_SERVICE_ACCOUNT_KEY }}
          FILE_TO_UPLOAD: oneMonthUSDHKD.csv
          GDRIVE_FOLDER_ID: ${{ secrets.GDRIVE_FOLDER_ID }}
        run: node ${{ github.workspace }}/tools/upload/upload-to-drive.js
